m_sus_big = big_one_df %>%
mutate(class = case_when(sn_m_sus > 0.30 ~ "High severity",
sn_m_sus <= 0.30 ~"Low severity"))%>%
mutate(class2 = case_when(b0_m_sus > median(b0_m_sus) ~ "High yield",
b0_m_sus <= median(b0_m_sus) ~ "Low yield"))
sus_big = big_one_df %>%
mutate(class = case_when(sn_sus > 0.30 ~ "High severity",
sn_sus <= 0.30 ~"Low severity"))%>%
mutate(class2 = case_when(b0_sus > median(b0_sus) ~ "High yield",
b0_sus <= median(b0_sus) ~ "Low yield"))
median(big_one_df$sn_res)
median(big_one_df$sn_m_sus)
median(big_one_df$sn_sus)
median(big_one_df$b0_res)
median(big_one_df$b0_m_sus)
median(big_one_df$b0_sus)
40+35+15
90/3
gc()
high_p <- res_high  %>%
group_by(class, class2) %>%
summarise(perc= mean(prob >= 0.8, na.rm = TRUE) * 100,
num= sum(prob >= 0.8, na.rm = TRUE)) %>%
ungroup()
medium_p <- m_sus_heat  %>%
group_by(class, class2) %>%
summarise(perc= mean(prob >= 0.8, na.rm = TRUE) * 100,
num= sum(prob >= 0.8, na.rm = TRUE)) %>%
ungroup()
low_p <- sus_heat %>%
group_by(class, class2) %>%
summarise(perc= mean(prob >= 0.8, na.rm = TRUE) * 100,
num= sum(prob >= 0.8, na.rm = TRUE)) %>%
ungroup()
low_p
# Moderate Resistant (MR)
gain_res = big_one_df %>%
mutate(class = case_when(sn_res > 0.30 ~ "High severity",
sn_res <= 0.30 ~"Low severity")) %>%
mutate(class2 = case_when(b0_res > median(b0_res) ~ "High yield",
b0_res <= median(b0_res) ~ "Low yield"))
gc()
# Moderate Susceptible (MS)
gain_m_sus = big_one_df %>%
mutate(class = case_when(sn_m_sus > 0.30 ~ "High severity",
sn_m_sus <= 0.30 ~"Low severity"))%>%
mutate(class2 = case_when(b0_m_sus > median(b0_m_sus) ~ "High yield",
b0_m_sus <= median(b0_m_sus) ~ "Low yield"))
gc()
# Susceptible (S)
gain_sus = big_one_df %>%
mutate(class = case_when(sn_sus > 0.30 ~ "High severity",
sn_sus <= 0.30 ~"Low severity"))%>%
mutate(class2 = case_when(b0_sus > median(b0_sus) ~ "High yield",
b0_sus <= median(b0_sus) ~ "Low yield"))
gc()
# Moderate Resistant (MR)
overal_res = gain_res %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
#mutate(sev_class = " Overall") %>%
dplyr::group_by(lambda,class,class2) %>%
summarise(yield_gain_median = median(yield_gain_res),
yield_gain_mean = mean(yield_gain_res),
up_95 = quantile(yield_gain_res, 0.975),
low_95 = quantile(yield_gain_res, 0.025),
up_75 = quantile(yield_gain_res, 0.75),
low_75 = quantile(yield_gain_res, 0.25))
overal_res$condition = "High"
overal_res_w = gain_res %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
dplyr::group_by(lambda) %>%
summarise(yield_gain_median = median(yield_gain_res),
yield_gain_mean = mean(yield_gain_res),
up_95 = quantile(yield_gain_res, 0.975),
low_95 = quantile(yield_gain_res, 0.025),
up_75 = quantile(yield_gain_res, 0.75),
low_75 = quantile(yield_gain_res, 0.25))
gc()
# Moderate Susceptible (MS)
overal_m_sus = gain_m_sus %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
#mutate(sev_class = " Overall") %>%
dplyr::group_by(lambda, class,class2) %>%
summarise(yield_gain_median = median(yield_gain_m_sus),
yield_gain_mean = mean(yield_gain_m_sus),
up_95 = quantile(yield_gain_m_sus, 0.975),
low_95 = quantile(yield_gain_m_sus, 0.025),
up_75 = quantile(yield_gain_m_sus, 0.75),
low_75 = quantile(yield_gain_m_sus, 0.25))
gc()
overal_m_sus$condition = "Medium"
overal_m_sus_w = gain_m_sus %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
dplyr::group_by(lambda) %>%
summarise(yield_gain_median = median(yield_gain_m_sus),
yield_gain_mean = mean(yield_gain_m_sus),
up_95 = quantile(yield_gain_m_sus, 0.975),
low_95 = quantile(yield_gain_m_sus, 0.025),
up_75 = quantile(yield_gain_m_sus, 0.75),
low_75 = quantile(yield_gain_m_sus, 0.25))
gc()
# Susceptible (S)
overal_sus = gain_sus %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
#mutate(sev_class = " Overall") %>%
dplyr::group_by(lambda, class,class2) %>%
summarise(yield_gain_median = median(yield_gain_sus),
yield_gain_mean = mean(yield_gain_sus),
up_95 = quantile(yield_gain_sus, 0.975),
low_95 = quantile(yield_gain_sus, 0.025),
up_75 = quantile(yield_gain_sus, 0.75),
low_75 = quantile(yield_gain_sus, 0.25))
gc()
overal_sus$condition = "Low"
overal_sus_w = gain_sus %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
dplyr::group_by(lambda) %>%
summarise(yield_gain_median = median(yield_gain_sus),
yield_gain_mean = mean(yield_gain_sus),
up_95 = quantile(yield_gain_sus, 0.975),
low_95 = quantile(yield_gain_sus, 0.025),
up_75 = quantile(yield_gain_sus, 0.75),
low_75 = quantile(yield_gain_sus, 0.25))
overall_cultivar = rbind(overal_res,overal_m_sus,overal_sus)
overall_cultivar %>%
group_by(condition) %>%
summarise(
max = max(yield_gain_median),
min =  min(yield_gain_median),
p.p = max -min)
overall_cultivar %>%
group_by(condition,class,class2) %>%
summarise(
max = max(yield_gain_median),
min =  min(yield_gain_median),
p.p = max -min)
decline = big_one_df %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
filter(!lambda <0.40) %>%
filter(!lambda > 0.80)
decline
decline[decline$lambda== 0.80,c("year")] <- 0
decline[decline$lambda== 0.75,c("year")] <- 1
decline[decline$lambda== 0.70,c("year")] <- 2
decline[decline$lambda== 0.65,c("year")] <- 3
decline[decline$lambda== 0.60,c("year")] <- 4
decline[decline$lambda== 0.55,c("year")] <- 5
decline[decline$lambda== 0.50,c("year")] <- 6
decline[decline$lambda== 0.45,c("year")] <- 7
decline[decline$lambda== 0.40,c("year")] <- 8
# Moderate Resistant (MR)
gain_res_dec = decline %>%
mutate(class = case_when(sn_res > 0.30 ~ "High severity",
sn_res <= 0.30 ~"Low severity")) %>%
mutate(class2 = case_when(b0_res > median(b0_res) ~ "High yield",
b0_res <= median(b0_res) ~ "Low yield"))
# Moderate Susceptible (MS)
gain_m_sus_dec = decline %>%
mutate(class = case_when(sn_m_sus > 0.30 ~ "High severity",
sn_m_sus <= 0.30 ~"Low severity"))%>%
mutate(class2 = case_when(b0_m_sus > median(b0_m_sus) ~ "High yield",
b0_m_sus <= median(b0_m_sus) ~ "Low yield"))
# Susceptible (S)
gain_sus_dec = decline %>%
mutate(class = case_when(sn_sus > 0.30 ~ "High severity",
sn_sus <= 0.30 ~"Low severity"))%>%
mutate(class2 = case_when(b0_sus > median(b0_sus) ~ "High yield",
b0_sus <= median(b0_sus) ~ "Low yield"))
# Moderate Resistant (MR)
overal_res_dec = gain_res_dec %>%
#mutate(sev_class = " Overall") %>%
dplyr::group_by(year,class,class2) %>%
summarise(yield_gain_median = median(yield_gain_res),
yield_gain_mean = mean(yield_gain_res),
up_95 = quantile(yield_gain_res, 0.975),
low_95 = quantile(yield_gain_res, 0.025),
up_75 = quantile(yield_gain_res, 0.75),
low_75 = quantile(yield_gain_res, 0.25))
gc()
overal_res_dec$condition = "High"
# Moderate Susceptible (MS)
overal_m_sus_dec = gain_m_sus_dec %>%
#mutate(sev_class = " Overall") %>%
dplyr::group_by(year, class,class2) %>%
summarise(yield_gain_median = median(yield_gain_m_sus),
yield_gain_mean = mean(yield_gain_m_sus),
up_95 = quantile(yield_gain_m_sus, 0.975),
low_95 = quantile(yield_gain_m_sus, 0.025),
up_75 = quantile(yield_gain_m_sus, 0.75),
low_75 = quantile(yield_gain_m_sus, 0.25))
gc()
overal_m_sus_dec$condition = "Medium"
# Susceptible (S)
overal_sus_dec = gain_sus_dec %>%
#mutate(sev_class = " Overall") %>%
dplyr::group_by(year, class,class2) %>%
summarise(yield_gain_median = median(yield_gain_sus),
yield_gain_mean = mean(yield_gain_sus),
up_95 = quantile(yield_gain_sus, 0.975),
low_95 = quantile(yield_gain_sus, 0.025),
up_75 = quantile(yield_gain_sus, 0.75),
low_75 = quantile(yield_gain_sus, 0.25))
gc()
overal_sus_dec$condition = "Low"
overall_cultivar_dec = rbind(overal_res_dec,overal_m_sus_dec,overal_sus_dec)
overall_cultivar_dec <- overall_cultivar_dec %>%
mutate(condition = factor(condition, levels = c("High", "Medium", "Low")))
loss_overall = overall_cultivar_dec %>%
filter(year %in% c("0","8")) %>%
group_by(condition, class, class2) %>%
summarise(
yield_diff = yield_gain_mean[year == 8] - yield_gain_mean[year == 0],
sc = (yield_diff*-1)/27.21, # Sc para bushel
loss = sc*10.97 #Pre√ßo do bushel
)
loss_overall <- loss_overall %>%
mutate(condition = factor(condition, levels = c("High", "Medium", "Low")))
loss <- overall_cultivar_dec %>%
filter(!is.na(class)) %>%
filter(year %in% 0:8) %>%
group_by(condition, class, class2) %>%
mutate(yield_gain_zero = yield_gain_mean[year == 0],
up_95_zero = up_95[year == 0],
low_95_zero = low_95[year == 0]) %>%
filter(year != 0) %>%
summarise(
year = year,
yield_diff = yield_gain_mean - yield_gain_zero,
up_95_diff = up_95 - up_95_zero,
low_95_diff = low_95 - low_95_zero,
sc_yield = (yield_diff*-1)/27.21,
sc_up = (up_95_diff*-1)/27.21,
sc_low = (low_95_diff*-1)/27.21,
loss_yield = sc_yield*10.97,
loss_up = sc_up*10.97,
loss_low = sc_low*10.97
)
loss
# Scenarios
loss %>%
group_by(condition,class, class2) %>%
summarise(
rate = cov(year, loss_yield) / var(year))
# Overall
loss %>%
group_by(condition) %>%
summarise(
rate = cov(year, loss_yield) / var(year))
qt_res_overall = gain_res %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
#mutate(sev_class = " Overall") %>%
#dplyr::group_by(class,class2) %>%
filter(lambda %in% c(0.40,0.80)) %>%
dplyr::group_by(lambda) %>%
summarise(
yield_gain_mean = mean(yield_gain_res),
yield_gain_median = median(yield_gain_res),
low_95 = quantile(yield_gain_res, 0.025),
up_95 = quantile(yield_gain_res, 0.975),
up_75 = quantile(yield_gain_res, 0.75),
low_75 = quantile(yield_gain_res, 0.25))
# Moderate Susceptible (MS)
qt_m_sus_overall = gain_m_sus %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
filter(lambda %in% c(0.40,0.80)) %>%
dplyr::group_by(lambda) %>%
summarise(yield_gain_mean = mean(yield_gain_m_sus),
yield_gain_median = median(yield_gain_m_sus),
low_95 = quantile(yield_gain_m_sus, 0.025),
up_95 = quantile(yield_gain_m_sus, 0.975),
up_75 = quantile(yield_gain_m_sus, 0.75),
low_75 = quantile(yield_gain_m_sus, 0.25))
gc()
# Susceptible (S)
qt_sus_overall = gain_sus %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
filter(lambda %in% c(0.40,0.80)) %>%
dplyr::group_by(lambda) %>%
summarise(yield_gain_mean = mean(yield_gain_sus),
yield_gain_median = median(yield_gain_sus),
low_95 = quantile(yield_gain_sus, 0.025),
up_95 = quantile(yield_gain_sus, 0.975),
up_75 = quantile(yield_gain_sus, 0.75),
low_75 = quantile(yield_gain_sus, 0.25))
gc()
qt_res = gain_res %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
filter(lambda %in% c(0.40,0.80)) %>%
#mutate(sev_class = " Overall") %>%
dplyr::group_by(lambda,class,class2) %>%
summarise(yield_gain_mean = mean(yield_gain_res),
yield_gain_median = median(yield_gain_res),
low_95 = quantile(yield_gain_res, 0.025),
up_95 = quantile(yield_gain_res, 0.975),
up_75 = quantile(yield_gain_res, 0.75),
low_75 = quantile(yield_gain_res, 0.25))
# Moderate Susceptible (MS)
qt_m_sus = gain_m_sus %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
#mutate(sev_class = " Overall") %>%
filter(lambda %in% c(0.40,0.80)) %>%
dplyr::group_by(lambda,class,class2) %>%
summarise(yield_gain_mean = mean(yield_gain_m_sus),
yield_gain_median = median(yield_gain_m_sus),
low_95 = quantile(yield_gain_m_sus, 0.025),
up_95 = quantile(yield_gain_m_sus, 0.975),
up_75 = quantile(yield_gain_m_sus, 0.75),
low_75 = quantile(yield_gain_m_sus, 0.25))
gc()
# Susceptible (S)
qt_sus = gain_sus %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
#mutate(sev_class = " Overall") %>%
filter(lambda %in% c(0.40,0.80)) %>%
dplyr::group_by(lambda,class,class2) %>%
summarise(yield_gain_mean = mean(yield_gain_sus),
yield_gain_median = median(yield_gain_sus),
low_95 = quantile(yield_gain_sus, 0.025),
up_95 = quantile(yield_gain_sus, 0.975),
up_75 = quantile(yield_gain_sus, 0.75),
low_75 = quantile(yield_gain_sus, 0.25))
high_p
loss <- overall_cultivar_dec %>%
filter(!is.na(class)) %>%
filter(year %in% 0:8) %>%
group_by(condition, class, class2) %>%
mutate(yield_gain_zero = yield_gain_mean[year == 0],
up_95_zero = up_95[year == 0],
low_95_zero = low_95[year == 0]) %>%
filter(year != 0) %>%
summarise(
year = year,
yield_diff = yield_gain_mean - yield_gain_zero,
up_95_diff = up_95 - up_95_zero,
low_95_diff = low_95 - low_95_zero,
sc_yield = (yield_diff*-1)/27.21,
sc_up = (up_95_diff*-1)/27.21,
sc_low = (low_95_diff*-1)/27.21,
loss_yield = sc_yield*10.97,
loss_up = sc_up*10.97,
loss_low = sc_low*10.97
)
loss
decline
overall_cultivar_dec
write_xlsx(overall_cultivar_dec,"data/overall_cultivar_dec")
write_xlsx(overall_cultivar_dec,"data/overall_cultivar_dec.xlsx")
overall_cultivar_dec = read_xlsx("data/overall_cultivar_dec.xlsx")
overall_cultivar_dec
write_xlsx(loss,"data/loss.xlsx")
loss
loss = read_xlsx("data/loss")
loss = read_xlsx("data/loss.xlsx")
gain_res
qt_overall = rbind(qt_res_overall,qt_m_sus_overall,qt_sus_overall)
qt_overall
write.xlsx(qt_overall,"data/qt_overall.xlsx")
write_xlsx(qt_overall,"data/qt_overall.xlsx")
qt_overall = read_xlsx("data/qt_overall.xlsx")
qt_overall
qt_res = gain_res %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
filter(lambda %in% c(0.40,0.80)) %>%
#mutate(sev_class = " Overall") %>%
dplyr::group_by(lambda,class,class2) %>%
summarise(yield_gain_mean = mean(yield_gain_res),
yield_gain_median = median(yield_gain_res),
low_95 = quantile(yield_gain_res, 0.025),
up_95 = quantile(yield_gain_res, 0.975),
up_75 = quantile(yield_gain_res, 0.75),
low_75 = quantile(yield_gain_res, 0.25))
# Moderate Susceptible (MS)
qt_m_sus = gain_m_sus %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
#mutate(sev_class = " Overall") %>%
filter(lambda %in% c(0.40,0.80)) %>%
dplyr::group_by(lambda,class,class2) %>%
summarise(yield_gain_mean = mean(yield_gain_m_sus),
yield_gain_median = median(yield_gain_m_sus),
low_95 = quantile(yield_gain_m_sus, 0.025),
up_95 = quantile(yield_gain_m_sus, 0.975),
up_75 = quantile(yield_gain_m_sus, 0.75),
low_75 = quantile(yield_gain_m_sus, 0.25))
gc()
# Susceptible (S)
qt_sus = gain_sus %>%
filter(C <= 180) %>%
filter(C >= 60) %>%
#mutate(sev_class = " Overall") %>%
filter(lambda %in% c(0.40,0.80)) %>%
dplyr::group_by(lambda,class,class2) %>%
summarise(yield_gain_mean = mean(yield_gain_sus),
yield_gain_median = median(yield_gain_sus),
low_95 = quantile(yield_gain_sus, 0.025),
up_95 = quantile(yield_gain_sus, 0.975),
up_75 = quantile(yield_gain_sus, 0.75),
low_75 = quantile(yield_gain_sus, 0.25))
qt_efic = rbind(qt_res,qt_m_sus,qt_sus)
write_xlsx(qt_efic,"data/qt_efic.xlsx")
qt_efic = read_xlsx("data/qt_efic.xlsx")
qt_efic
tss_overall_EDT
damage_adjusted_medium
ma_c %>%
filter(cultivar %in% c_01$cultivar) %>%
#group_by(study) %>%
do(tidy(lm(.$yld ~ .$sev)))
ma_c %>%
#group_by(study) %>%
do(tidy(lm(.$yld ~ .$sev)))
damage_c_overall = data.frame()
damage_c_overall = data.frame()
damage_c_overall
damage_c_overall$DC_overall = DC_overall
damage_c_overall["DC_overall"] = DC_overall
damage_c_overall
damage_c_overall = as.data.frame(DC_overall)
damage_c_overall
damage_c_overall$DC_1000 = DC_1000
damage_c_overall
# Overall
DC_overall = (14.7/4058)
DC_1000 = DC_overall*1000
DC_perc_overall = DC_overall*100
damage_kg = DC_1000*18.2
damage_perc  = (damage_kg*100)/1000
damage_adjusted = DC_1000*18.2*4
damage_c_overall = as.data.frame(DC_overall)
damage_c_overall$DC_1000 = DC_1000
damage_c_overall$DC_perc_overall = DC_perc_overall
damage_c_overall$damage_kg = damage_kg
damage_c_overall$damage_perc = damage_perc
damage_c_overall$damage_adjusted = damage_adjusted
damage_c_overall
DC_high = (9.7/4047)
DC_1000_high = DC_high*1000
DC_perc_high = DC_high*100
damage_kg_high = DC_1000_high*18.9
damage_perc_high  = (damage_kg_high*100)/1000
damage_adjusted_high = DC_1000_high*18.9*4
damage_h_overall = as.data.frame(DC_high)
damage_h_overall$DC_1000_high = DC_1000_high
damage_h_overall$DC_perc_high = DC_perc_high
damage_h_overall$damage_kg_high = damage_kg_high
damage_h_overall$damage_perc_high = damage_perc_high
damage_h_overall$damage_adjusted_high = damage_adjusted_high
damage_h_overall
DC_medium = (25.9/4256)
DC_1000_medium = DC_medium*1000
DC_perc_medium = DC_medium*100
damage_kg_medium = DC_1000_medium*17.3
damage_perc_medium  = (damage_kg_medium*100)/1000
damage_adjusted_medium = DC_1000_medium*17.3*4.2
damage_m_overall = as.data.frame(DC_medium)
damage_m_overall$DC_1000_medium = DC_1000_medium
damage_m_overall$DC_perc_medium = DC_perc_medium
damage_m_overall$damage_kg_medium = damage_kg_medium
damage_m_overall$damage_perc_medium = damage_perc_medium
damage_m_overall$damage_adjusted_medium = damage_adjusted_medium
damage_m_overall
DC_low = (45/4272)
DC_1000_low = DC_low*1000
DC_perc_low = DC_low*100
damage_kg_low = DC_1000_low*8.4
damage_perc_low  = (damage_kg_low*100)/1000
damage_adjusted_low = DC_1000_low*8.4*4.2
damage_l_overall = as.data.frame(DC_low)
damage_l_overall$DC_1000_low = DC_1000_low
damage_l_overall$DC_perc_low = DC_perc_low
damage_l_overall$damage_kg_low = damage_kg_low
damage_l_overall$damage_perc_low = damage_perc_low
damage_l_overall$damage_adjusted_low = damage_adjusted_low
damage_l_overall
class(res_regression)
res_regression = as.data.frame(res_regression)
m_sus_regression
gc()
library(tidyverse)
library(dplyr)
library(metafor)
library(ggplot2)
library(gsheet)
library(cowplot)
library(broom)
library(writexl)
library(readxl)
library(ggthemes)
library(minpack.lm)
t = gsheet2tbl("https://drive.google.com/file/d/1AP2XJJyxhqIUCAP6MgbtI2UdX-mwg-WG/view?usp=sharing")
t = gsheet2tbl("https://drive.google.com/file/d/1AP2XJJyxhqIUCAP6MgbtI2UdX-mwg-WG/view?usp=sharing")
t = gsheet2tbl("https://drive.google.com/file/d/1AP2XJJyxhqIUCAP6MgbtI2UdX-mwg-WG/view?usp=sharing")
t = gsheet2tbl("https://drive.google.com/file/d/1AP2XJJyxhqIUCAP6MgbtI2UdX-mwg-WG/view?usp=drive_link")
t = gsheet2tbl("https://drive.google.com/file/d/1AP2XJJyxhqIUCAP6MgbtI2UdX-mwg-WG/view?usp=drive_link")
t = read.csv("https://drive.google.com/file/d/1AP2XJJyxhqIUCAP6MgbtI2UdX-mwg-WG/view?usp=drive_link")
t = read_csv("https://drive.google.com/file/d/1AP2XJJyxhqIUCAP6MgbtI2UdX-mwg-WG/view?usp=drive_link")
t
gc()
